---
title: "Assessing environmental and predator impacts on Antarctic Krill (*Euphausia superba*) population dynamics from an integrated catch-at-length model perspective"
author:
  - Mauricio Mardones ^[Universidad de Magallanes, mamardon@umag.cl, Instituto Milenio Base]
  - Erica Jarvis Mason^[Antarctic División NOAA, USA]
  - Andrea Pinones ^[Instituto Antártico Chileno, Instituto Milenio Base, Chile]
  - Lucas Krüger ^[Instituto Antártico Chileno, Instituto Milenio Base, Chile]
  - Francisco Santa Cruz ^[Instituto Antártico Chileno, Universidad de Magallanes, Instituto Milenio Base]
  - César Cárdenas^[Instituto Antártico Chileno, Instituto Milenio Base, Chile]
  - Richard Methot ^[NOAA, Fishery Science División, NorthWeast, Seattle, USA]
output:
  bookdown::word_document2:
    reference_docx: MS2_Krill_template.docx.docx
    number_sections: false
fig_caption: yes
bibliography: SA_krill.bib
#csl: apa.csl
csl: icesjournal.csl
link-citations: yes
toc: false
linkcolor: blue
linestretch: 1.5
header-includes:
- \fontsize{12}{16}
- \selectfont
- \usepackage{lscape}
---


```{r setup1, echo=FALSE}
rm(list = ls())
knitr::opts_chunk$set(eval=FALSE,
                      echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      fig.align = 'center',
                      fig.pos = "H",
                      fig.show='hold',
                      dev = 'jpeg',
                      dpi = 300,
                      tidy.opts=list(width.cutoff=50), 
                      tidy=TRUE)
```

```{r message=FALSE, eval=TRUE}
library(here)
library(kableExtra)
library(ggpubr)
library(tibble)
library(readxl)
library(openxlsx)
library(r4ss)
library(readr)
library(flextable)
library(officer)
library(r4ss)
```

\newpage

# Abstract 

Understanding the population dynamics of Antarctic krill (*Euphausia superba*) is critical for achieving sustainable and ecosystem management objectives in the Western Antarctic Peninsula (WAP). In this study, we implement an integrated Catch-at-Length model that not only allows the incorporation of diverse data sources related to krill population dynamics, but also enables the evaluation of ecosystem influences—specifically environmental variability and predation pressure—on recruitment, biomass, and stock status. We explored multiple scenarios that accounted for ecosystem influences on krill population dynamics, yielding results that align with the expected behavior of a stock assessment framework tailored to this type of species. Performance analyses reveal systematic differences across scenarios, highlighting increased bias in fishing mortality (F) and spawning stock biomass (SSB) in models that exclude ecosystem variables. Conversely, the inclusion of environmental and predator data results in lower estimates of recruitment, total biomass, and spawning biomass, offering a more precautionary—and arguably more realistic—representation of krill population dynamics. Despite ongoing challenges in incorporating ecosystem variables into integrated model like this, we argue that these factors should be embedded directly into the state equations that govern population dynamics, rather than addressed through post hoc analyses. Overlooking these drivers may result in less accurate conclusions and limit the effectiveness of management recommendations. Integrated modeling approaches that draw on extensive biological, fishery, and environmental datasets provide a valuable foundation for developing management strategies aligned with CCAMLR’s conservation and sustainable use objectives.


*Keywords: Antarctic krill, population dynamics, stock-recruitment, ecosystem variables, Stock Synthesis model, perfomance model, fisheries management, CCAMLR*

\newpage

# Introduction

Antarctic krill (*Euphausia superba*) is a keystone species in the Antarctic ecosystem and one of the largest populations on the planet in terms of biomass (REF). Currently, its population is predominantly concentrated in the Western Antarctic Peninsula (WAP), a critical feeding ground for predators and the primary area for krill harvesting over the past four decades (REF). At the same time, the WAP is one of the most vulnerable regions to climate change (CC) and has already undergone rapid environmental shifts [@Turner2005; @Lima2013; @McBride2021; @Morley2020; @Atkinson2019a]. These overlapping pressures have intensified scientific interest in understanding krill population dynamics from both an ecological and fisheries perspective. Given its ecological significance and commercial value, effective management of krill stocks is essential to maintaining the balance of the Antarctic ecosystem while supporting sustainable fisheries.

Recognizing this, the Commission for the Conservation of Antarctic Marine Living Resources (CCAMLR) has adopted a new management strategy (CCAMLR 2019) that follows an ecosystem-based approach. This strategy seeks to balance commercial harvesting with a precautionary framework that safeguards krill-dependent species. It includes three key components: (i) stock assessments to determine precautionary harvest rates, (ii) periodic updates of krill biomass estimates at multiple spatial scales, and (iii) a risk assessment framework, now referred to as spatial overlap analysis, to guide the spatial allocation of catches and mitigate ecosystem-wide risks.

As part of this strategy, CCAMLR has tested various modeling approaches to assess krill stock status and support fisheries management decisions [@Hill2016]. While model-based stock assessments have been widely used (REF), many struggle to align with management objectives or accurately represent krill population dynamics due to their spatial variability and ecosystem complexity. Traditionally, stock assessments have relied on single-source data, either from fisheries catches [@Kinzey2015a; @Wang2021] or population monitoring surveys [@Green2023; @Watters2013].  One widely applied approach is the General Yield Model (GRYM), which provides global catch limits based on predefined harvest thresholds [@Maschette2020]. However, such approaches often neglect key ecological drivers. Considering the influence of habitat on population dynamics, the role of environmental variability in shaping krill productivity, and the contribution of predators as a source of natural mortality, stock assessment frameworks should explicitly incorporate these ecosystem components to more accurately represent population processes.

There is now broad scientific consensus on the need for stock assessment models that incorporate multiple data sources, capture temporal and spatial variability, and account for ecosystem interactions. However, integrating these complexities presents several challenges. Long-term data consistency is often lacking due to variations in monitoring programs and sampling methodologies. Additionally, some areas have sparse or incomplete datasets on krill dynamics. Furthermore, indirect drivers, such as environmental variability and predator abundance, introduce another layer of complexity. Despite these gaps, a substantial amount of data exists on krill populations and their ecosystem, making it crucial to identify knowledge gaps and integrate available information into comprehensive models that support management recommendations. 

To address this need, we propose a conceptual framework for implementing a statistical model that integrates multiple data sources to assess the population dynamics of Antarctic krill in the Western Antarctic Peninsula (WAP) over the past decades. This approach incorporates biological, fishery, survey, and ecosystem-related information to provide a more comprehensive understanding of krill stock fluctuations and productivity. 

Specifically, we employ an integrated catch-at-length implemented in Stock Synthesis model [@Methot2013] that allows us to evaluate the effects of environmental drivers on recruitment and productivity, as well as the impact of predator components into an integrated stock assessment model to Antarctic krill. The primary objective of this study was to assess the statistical performance of different management metrics, population variables and parameters based on alternative approaches to incorporating both environmental and predator data into a typical krill stock assessment model. By analyzing differences in estimated biomass, recruitment patterns, and overall krill productivity across these scenarios, we aim to quantify the extent to which ecosystem factors drive krill population trends. This comparative approach enables us to assess the relative importance of environmental conditions and predator dynamics in shaping krill stocks, providing critical insights for both fisheries management and conservation efforts.

By integrating ecosystem drivers into the stock assessment process, this study aims to demonstrate how incorporating environmental and ecological factors enhances the accuracy of Antarctic krill population estimates and improves the ability to predict future stock trends under changing climate and ecological conditions. This perspective seeks to strengthen the scientific foundation for sustainable management recommendations, ensuring that krill harvesting strategies align with CCAMLR’s ecosystem-based management approach. Ultimately, the insights gained from this integrated modeling effort contribute to CCAMLR’s ongoing strategy to balance the sustainability of the krill fishery with the conservation of the broader Antarctic marine ecosystem, supporting both the species that depend on krill as a primary food source and the long-term resilience of the Southern Ocean.

\newpage


# Methodology

## Study Area

The study area corresponds to Subarea 48.1 in the WAP, where most krill fishing activity occurs and where CCAMLR has been working to implement a new management strategy at a reduced spatial scale. To refine the spatial resolution of krill population dynamics and analysis, we adopted the five strata proposed by CCAMLR: Bransfield Strait, Elephant Island, Gerlache Strait, Joinville Island, and the Southwest [@Dornam2021] (Fig 1 S1). While these strata were originally designed for management purposes without considering specific biological or population characteristics, their subdivision enables us to analyze the data at a finer scale. This level of detail facilitates the identification of heterogeneity across various data sources, whether these originate from the fishery or from environmental survey data, providing a more nuanced understanding of krill population dynamics. This spatial segregation of information is incorporated into the stock assessment model, making it a spatially explicit model that accounts for regional variability in population dynamics and external factors.

## Conceptual Model

In this approach we include spatial structure how an implicit approach where different areas are treated as separate fleets [REF]. Differences among strata have been identified from various perspectives of krill population dynamics [REF], as well as from the influence of environmental variability within Subarea 48.1 [REF] (Fig 2 S1). This approach allows integrate spatial heterogeneity into the stock assessment model to ensure that spatially structured processes are adequately represented. Although strata are treated as separate fleets, recruitment and growth processes remain unified, ensuring that the overall krill stock is modeled as a single population while accounting for spatially structured impacts at the Subarea 48.1 level. Each stratum is assigned a unique fishery and survey history, reflecting differences in harvesting intensity and spatial exploitation patterns. Survey indices and length composition data are fleet-specific, allowing for variations in data collection methods and regional abundance estimates. Selectivity is modeled separately for each strata to account for potential variations in size composition due to spatial heterogeneity or environmental conditions. The model considers interannual fluctuations of growth dynamics, maturity and reproduction, with a spawning pulse per year occurring in January regarding @REF. This approach represents a spatially implicit model, as it captures spatial variability in exploitation patterns without explicitly modeling movement or recruitment connectivity between areas. This allows for a more realistic assessment of krill stock productivity, in line with CCAMLR’s ecosystem-based management framework.

## Data Sources

Multiple sources of data were incorporated into the krill population dynamics model to improve inference and parameter estimation. These data include records from the krill fishery monitoring program, such as standardized CPUE (kg/time haul) and length compositions, which have been consistently collected on board fishing vessels by scientific observers through the CCAMLR Scheme of International Scientific Observation (SISO). This dataset contains detailed information including vessel identity, nationality, and georeferenced positions used in the exploratory analysis. In addition, scientific research cruises conducted under the AMLR program provided critical data such as krill biomass indices by strata and biological characteristics of krill obtained via net sampling. Krill length compositions from AMLR surveys (provided by the Ecosystem Science Division of NOAA) were formatted according to model evaluation template requirements (see Supplementary Material 2). Environmental and predator-related data were also incorporated, such as satellite-derived chlorophyll-a concentrations from the Copernicus Marine Service and predator abundance and diet composition, particularly from penguin colonies reported in the [MAPPPD database](https://www.penguinmap.com/mapppd/sources/). A summary of all data sources, including temporal coverage and spatial scale, is provided in Table \@ref(tab:data-sources).

```{r data-sources, eval=TRUE}
data <- data.frame(
  Source = c(
    "Krill Fishery Monitoring Program (CCAMLR SISO)",
    "Krill Fishery Monitoring Program (CCAMLR SISO)",
    "Krill Fishery Monitoring Program (CCAMLR SISO)",
    "AMLR Scientific Research Cruises",
    "Satellite Remote Sensing",
    "Predator Monitoring (MAPPPD)",
    "Predator Diet Composition (AMLR)"
  ),
  Description = c(
    "Total reported catches",
    "Standardized CPUE (by vessel, area, and depth)",
    "Length-frequency distributions (0.2 cm bins)",
    "Biomass indices by strata from net sampling",
    "Monthly chlorophyll-a concentration from EU Copernicus Marine Service (interpolated; doi:10.48670/moi-00021, doi:10.48670/moi-00148)",
    "Abundance and colony-specific trends of penguin populations",
    "Length-frequency of krill in predator diets (e.g., penguins)"
  ),
  TimeSeries = c(
    "1997–2020",
    "1997–2020",
    "2000–2020",
    "1991–2011 (based on cruise periods)",
    "1997–present",
    "2000s–present",
    "1977–2020 (subset from 2000 used in this analysis)"
  ),
  SpatialScale = c(
    "By strata",
    "By strata",
    "By strata",
    "By strata",
    "Subarea 48.1",
    "By colony",
    "By colony"
  )
)


ft_data <- flextable(data) %>%
  set_caption("Table: Data sources used in the krill population dynamics modeling") %>%
  autofit() %>%
  theme_vanilla() %>%
  fontsize(size = 9, part = "all") %>%
  font(fontname = "Arial", part = "all") %>%
  set_table_properties(layout = "autofit", width = .85)

ft_data

```


Life history parameters, like growth, weight-length relation, natural mortality and maturity was used as priors to model initial condition in krill dynamics population was taken from @Smith2023a, @Maschette2020 and @Kinzey2011 and can be found in Table \@ref(tab:parainit1). Source data and temporal scale used in this stock assessment is showed in Fig 4, S1.

```{r parainit1, eval=TRUE}
dir1.1<-here("s1.1") 
start1 <- SS_readstarter(file = file.path(dir1.1,
                                          "starter.ss"),
                              verbose = FALSE)
dat1 <- SS_readdat(file = file.path(dir1.1, start1$datfile),
                        verbose = FALSE)
ctl1 <-  r4ss::SS_readctl(file = file.path(dir1.1,
                                    start1$ctlfil),
                        verbose = FALSE,
                        use_datlist = TRUE, 
                   datlist = dat1)
fore1 <- r4ss::SS_readforecast(file = file.path(dir1.1, 
                                                "forecast.ss"),
                              verbose = FALSE)
parbio<-ctl1$MG_parms[1:10,c(1:4,7)]
 row.names( parbio)<-c("Nat M",
                       "Lmin", 
                       "Lmax",
                       "VonBert K",
                       "CV young",
                       "CV old", 
                       "Wt a", 
                       "Wt b",
                       "L50%", 
                       "Mat slope")
 SRpar<-ctl1$SR_parms[1:5,c(1:4,7)]
 Qpar<-ctl1$Q_parms[1:2,c(1:4,7)]
 Selpar<-ctl1$size_selex_parms[1:22,c(1:4,7)]
 
 parInit<-as.data.frame(rbind(parbio,SRpar,Qpar,Selpar))
parInit %>% 
  kable(format = "latex",
        booktabs = TRUE, 
        caption = "Input parameters for the initial SS3 model of krill. Each parameter line contains a minimum value (LO), maximum value (HI), and initial value (INIT). If the phase (PHASE) for the parameter is negative, the parameter is fixed as input") %>%
  kable_styling(latex_options = c("striped"), 
                full_width = FALSE, 
                font_size = 9) %>%
  pack_rows(index = c("Natural Mortality" = 1,
                      "Growth" = 5,
                      "Length-Weight Relation" = 2,
                      "Maturity" = 2,
                      "Stock-Recruit Relation" = 5,
                      "Catchability" = 2,
                      "Selectivity" = 4))
```


## Catch-to-Length Model Implementation

The stock assessment model to krill was configured using Stock Synthesis (SS3 hereafter) [@Methot2013] with the updated version 3.30.21. SS3 is a structured stock evaluation model, in the class of models called *"Integrated stock evaluation analysis model"* and has a set of sub-model that simulates growth, maturity, fecundity, recruitment, and mortality processes, and observation, with expected values for different types of data. The model is coded in Automatic Differentiation Model Builder (ADMB) [@Fournier2012; @Methot2013: @methot2020stock] with estimation parameters. The methodology employed by Stock Synthesis involves a comprehensive and integrated approach, utilizing various data sources described previously and modeling techniques to estimate the main population variables of krill in WAP, and unlike other integrated models, it has features that allow the integration of information related to the ecosystem, such as predators and environmental variables that have proven influence on the analyzed population. All analysis were executed in R-CRAN [@R-base]and the graphical interface of the SS3 through *r4ss* [@Taylor2019] and *ss3diags* packages [@Winker2023]. 

Like many invertebrates, krill present challenges for age determination [@Punt2013]. Historically, aging techniques have not been available for this species, although recent advancements have been made [@Kilada2017]. As a result, stock assessments have relied on catch-at-length models with age dynamics approximated through transition matrices, which estimate the probability of individuals belonging to specific age classes based on their length. Integrated models can effectively capture the age structure of such populations by transforming length observations into population-level dynamics. Given the scarcity—or absence—of direct age data in krill monitoring programs, length-based models offer a practical alternative to age-structured approaches. Length data are generally more abundant and cost-effective to collect [@Canales2021, @Chong2019], and, due to the correlation between length and age, they provide valuable information about population structure. To date, all integrated krill assessments have used catch-at-length frameworks [@Kinzey2015a; @Kinzey2019a; @Wang2021]. Stock assessment models often rely on Age-Length Keys (ALKs) to infer the age structure of a population from observed length-frequency data [@ICCA2003]. An ALK is a probabilistic matrix that estimates the likelihood of individuals of a given length belonging to specific age classes. ALKs assume both aged and measured fish are random samples from the same population and should be applied within the same time period to avoid biases. This approach allows the transformation of catch-at-length data into age-structured information, which is essential for age-based modeling frameworks. The ALK matrix is typically defined as:

$$
P(A = a \mid L = l) = \frac{N_{a,l}}{\sum_{a} N_{a,l}}
$$
where \( P(A = a \mid L = l) \) is the probability that an individual of length \( l \) belongs to age \( a \),  \( N_{a,l} \) is the number of individuals of age \( a \) observed at length \( l \) and the denominator \( \sum_{a} N_{a,l} \) ensures that the probabilities sum to 1 for each length class. This matrix is then used in the model to allocate observed length compositions into age classes, typically through multiplication with a length-frequency vector:

$$
N_a = \sum_{l} P(A = a \mid L = l) \cdot N_l
$$

where \( N_l \) is the number of fish observed at length \( l \), and \( N_a \) is the estimated number at age. In integrated stock assessment models, such as those using statistical catch-at-age (SCAA) or integrated length-based frameworks, the ALK provides a critical link between observable length data and underlying age-based population dynamics.

The proportions-at-age are then adjusted to find the best fit between the observed size frequency data and that predicted by the proportion-at-age and the ALK. The majority of ALKs are based on growth parameters according to the most suitable formula for the species. In the case of krill, these parameters are derived from the von Bertalanffy growth curve. In @Mardones2023, using `SS3` stock assessment catch-at-lenght model, we use a von Bertalanffy growth relationship with estimated parameters L~inf~, k, and CV. This length-at-age relationship, mediated by survey catchability and selectivity, was used to compare survey biomass with model estimates of vulnerable biomass. Weight-at-length was assumed known and calculated using @Maschette2020 parameters in krill resulting in a AKL exposed in Figure \@ref(fig:AKL)).


```{r AKL, eval=TRUE, out.width='60%',  fig.cap="Representation of ALK Matrix to krill in Subarea 48.1"}
knitr::include_graphics('Figs/AKL.png')
```

Growth was modeled following a von Bertalanffy growth function with size-at-age parameterization. The model assumed linear growth below a predefined settlement age of 1.5 years. The asymptotic length ($L_{\infty}$) was determined by the estimated length-at-age, indicating that the model used $L_{\infty}$ as an upper growth boundary. Exponential decay of growth beyond maximum age was disabled, ensuring that growth patterns followed the von Bertalanffy assumption without artificial constraints. Growth variability was not explicitly modeled, and the coefficient of variation (CV) was assumed to be a function of length-at-age. Maturity was modeled as an age-based logistic function, with the first age of maturity set at 3 years. Fecundity was estimated as a power function of body weight, where fecundity was computed as $Eggs = Wt \times (a + b \times Wt)$. The model did not account for hermaphroditism, assuming that all individuals maintained a fixed sex throughout their lifespan. The model used a direct parameterization without additional offsets between sexes. Under this assumption, male parameters with a value of 0 and a negative estimation phase were set equal to their corresponding female parameters. Regarding selectivity functions, it was modeled using a length-based logistic formulation for the fishery, survey, and predator fleets. The selectivity curve was defined by two key parameters: the size at 50% selectivity (inflection point) and the width of the selection range (95% width). The fishery was characterized by multiple selectivity patterns, each defined by an inflection point and a selection range width. The estimated inflection points varied between 2.0 and 3.5 cm, while the selection range widths spanned between 2.0 and 4.0 cm depending of strata. Parameter estimation phases were assigned, with negative values indicating fixed parameters. The survey selectivity was also modeled using a length-based logistic function. Inflection points ranged from 2.0 to 3.0 cm, with selection range widths consistently set at 1.0 cm. The phase assignment dictated whether parameters were freely estimated (positive phase values) or fixed (negative phase values). These differences in selectivity parameters are crucial for interpreting and modeling spatial heterogeneity among strata, as they reflect variability in size-dependent catchability across different regions and fleets (Fig 6, S1). The predator fleet followed a similar selectivity function, with a size-at-inflection point of 0.2 cm and a corresponding selection range width of 0.2 cm. assuming that the predator can capture a wider range of krill sizes. These parameters were estimated in later phases, allowing flexibility in their estimation. Across all selectivity functions, parameters with negative phase values were held fixed during the estimation process, ensuring model stability and preventing overparameterization in a initial step. The stock-recruitment (SR) relationship was modeled using a standard Beverton-Holt formulation, with the steepness parameter fixed at 0.85 in phase -4 to ensure consistency with previous studies. This reflects a weak stock-recruitment relationship, as krill recruitment largely depends on environmental conditions rather than spawning biomass [@REF]. The unfished recruitment ($R_0$) was estimated with a log-transformed mean recruitment value of 23, with a prior of 10. The parameter was freely estimated in phase 1.  The standard deviation of recruitment deviations ($SR\_sigmaR$) was set at 1.2 and fixed in phase -4 to constrain model variability. The regime shift parameter ($SR\_regime$) was set at 0 and fixed, implying no consideration of long-term recruitment regime shifts. Recruitment deviations were estimated to account for interannual variability in recruitment dynamics. The model used the deviation vector approach ($do\_recdev = 1$), where recruitment was modeled as a function of spawning stock biomass plus a deviation term. The main recruitment deviation period spanned from 1998 to 2020, with forecast deviations applied in subsequent years. Early recruitment deviations prior to 1998 were included, with an early deviation phase of -4 to ensure these values remained fixed. Bias adjustment was implemented, with key adjustment years defined as 1995.7 as the last early year with no bias adjustment, 2000.0 as the first year of full bias adjustment, 2015.7 as the last year of full bias adjustment, and 2022.3 as the first recent year with no bias adjustment. To prevent overparameterization, recruitment deviations were constrained between -5 and 5. Cyclic patterns in recruitment were assumed each tree and five years [@REF], and advanced recruitment options were enabled for model flexibility. All of these configurations can be reviewed in the repository section of S1.

## Environmental variable modelling

To identify the most influential environmental drivers of krill recruitment to be considered in stock evaluation processes, we examined the relationship between a recruitment index and three key environmental variables previously recognized as critical in shaping krill population dynamics: Sea Surface Temperature (SST), Sea Ice Concentration (SIC), and Chlorophyll-a concentration (Chla) [@Flores2012; @Morley2020; @Saba2014; @Veytia2021; @Walsh2020]. Table \@ref(tab:env) summarizes the key characteristics of the environmental datasets used in the analysis, including sea ice, sea surface temperature (SST), and chlorophyll a. These variables were obtained from different satellite platforms and reanalysis products, namely Nimbus-7, ERA5, and Copernicus. The table details spatial and temporal resolution, as well as the temporal coverage of each dataset.

```{r env, eval=TRUE}
env_features <- data.frame(
  Feature = c("Sea Ice", "SST", "Chlorophyll a"),
  Platform = c("Nimbus-7", "ERA5", "E.U. Copernicus Marine Service"),
  Spatial_Resolution = c("25 × 25 km", "0.25º × 0.25º", "0.25º × 0.25º"),
  Temporal_Resolution = c("Daily", "Monthly", "Daily-Monthly"),
  Time_Range = c("1978 - Present", "1991 - Present", "2000 - Present"),
  stringsAsFactors = FALSE
)

ft_env <- flextable(env_features) |>
  set_header_labels(
    Feature = "Feature",
    Platform = "Platform",
    Spatial_Resolution = "Spatial Resolution",
    Temporal_Resolution = "Temporal Resolution",
    Time_Range = "Time Range"
  ) |>
  set_caption("Summary of environmental variables used in correlation analysis") |>
  add_footer_lines("doi.org/10.48670/moi-00021; doi.org/10.48670/moi-00148") |>
  color(part = "header", color = "black") |>
  theme_booktabs() |>
  fontsize(size = 10) |>
  set_table_properties(layout = "autofit", width = .85)
ft_env
```


All environmental data were processed at their native spatial resolution using the R packages *sf* and *ncdf4* [@Pebezma2018; @Pierce2021], incorporating spatial manipulation, rasterization, and coordinate transformations. We model the relation the environmental influence on krill recruitment with a serie of linear models, progressively incorporating the environmental variables to identify the one with the greatest explanatory power. The initial model considered only the effect of strata (spat), while subsequent models sequentially included Chla, SST, Sea Ice Index and interaction terms. This modeling framework allowed us to determine the relative contribution of each factor and their interactions on the recruitment process. All models and their results can be found in the Supplementary Material 2.



One of the key challenges in this stock assessment framework is integrating ecosystem variables and drivers into the primary process of population dynamics [REF] and SS3 addresses these approaches. According to [@methot2020stock], Stock Synthesis (SS3) can estimate recruitment levels as a function of the spawning biomass from the previous season, incorporating the effects of an environmental time series and a log-bias adjustment. This integrated approach allows for a more realistic and dynamic estimation of recruitment by linking it to both biological and environmental drivers in this way;

$$
E(\text{Recruitment}) = f(\text{SpBio}) \times \exp(B \times \text{envdata}) \times \exp\left(-0.5 \times \pi_R^2\right)
$$
$R$ represents the variability of deviations, adding to the variance caused by environmental factors. $SpBio$ represent spawning biomass, $envdata$ is vector of time series of environmental variable. Consequently, as the environmental effect accounts for more of the total recruitment variability, the residual $R$ should be reduced. However, the model does not automatically adjust for this. Based on the results of linear models, we will identify the environmental variable that exhibits the strongest statistical influence on krill recruitment. This variable will be selected for inclusion in the stock assessment model to capture the environmental contribution to recruitment variability. By integrating the most influential environmental driver, the model is expected to enhance the biological realism of recruitment estimates and improve the accuracy of population dynamics esttimates.


## Predator modelling 


Following the SS3 framework described by @methot2020stock, natural mortality due to predation (*M2*) can be integrated into stock assessment models through multiple data types. In our krill assessment, we implement this by incorporating both predator biomass and diet composition from the three main penguin species in the Antarctic Peninsula: Adélie (*Pygoscelis adeliae*), Chinstrap (*Pygoscelis antarcticus*), and Gentoo (*Pygoscelis papua*). Predator abundance is treated as an index of predation "effort," allowing time-varying estimation of predation mortality rates. This follows the equation:

$$
M2_t = Q \cdot I_t
$$

where \( M2_t \) is the predation mortality in year *t*, \( I_t \) is the predator abundance index, and \( Q \) is a catchability coefficient. Additionally, length-frequency data of krill obtained from penguin diet samples are used to characterize the size-selectivity of predation. These data inform predator-specific selectivity functions for *M2*, enabling the model to represent how predation varies with krill size. This dual approach—using predator abundance and diet composition—supports a temporally and size-structured representation of predation mortality, aligning with ecosystem-based assessment principles. Total natural mortality (*M*) is thus partitioned as \(M = M_1 + \sum M_2 \), where \( M_1 \) is background mortality and \( \sum M_2 \) accounts for predator-specific contributions. Total mortality is expressed as \( Z = M_1 + M_2 + F \) combining natural and fishing-induced mortality.

\newpage

## Scenarios

To account for the uncertainty associated with ecosystem influence in krill dynamic popupation, we evaluated a set of model configurations that incorporate variations in predator "fleet" and environmental effects, and the relationship between spawning biomass and recruitment. Spatial heterogeneity implicity is considering in all scenarios. The methodology involves assessing the statistical performance of the model under these configurations. Specifically, `s1.1` serves as the reference model, incorporating only fishery and survey data while accounting for spatial heterogeneity. The subsequent scenarios build upon this configuration to evaluate the effects of additional ecological components. `s1.2` extends `s1.1` by incorporating predator influences, allowing the model to assess the impact of predation on krill population dynamics. `s1.3` modifies `s1.1` by introducing an environmental variable, capturing potential environmental drivers affecting krill recruitment and biomass. Finally, `s1.4` integrates both predator and environmental influences into the `s1.1` framework, providing a more comprehensive assessment of ecosystem interactions and their role in krill population dynamics (Table \@ref(tab:scenario)).

```{r scenario, eval=TRUE}
scenario_table <- data.frame(
  Scenario = c("s1.1", "s1.2", "s1.3", "s1.4"),
  Description = c(
    "Spatial data without environmental and predator components",
    "\"s1.1\" with predator components",
    "\"s1.1\" with environmental variable",
    "\"s1.1\" with both predator fleet and environmental variable"
  ),
  stringsAsFactors = FALSE
)
ft_scenarios <- flextable(scenario_table) |>
  set_header_labels(
    Scenario = "Scenario",
    Description = "Description"
  ) |>
  set_caption("Scenarios used for modelling dynamics in krill") |>
  theme_booktabs() |>
   fontsize(size = 10) |>
  set_table_properties(layout = "autofit", width = .85) %>% 
  color(part = "header", color = "black") 
ft_scenarios
```


Regarding the performance and comparison between scenarios, @Carvalho2017;  @Carvalho2021b; @Merino2022a and @Kell2021 propose good practice to made a structured approach for diagnosing stock assessment models to ensure their reliability and robustness. This diagnostic process was applied to the krill stock assessment and involved several key steps propoesed by previus research. First, convergence analysis was conducted to evaluate whether the estimation algorithm reached a stable solution. This included reviewing parameter trace plots, gradients, and the Hessian matrix to ensure that all parameters were well-estimated.  Next, model fit to data was assessed by comparing observed and predicted values across key data sources, including catch, survey indices, and length composition. The p-values for the residual runs tests were computed for each of the four joint length compositions that are common in all models. The p-values were then combined into a single test statistic using Fisher's method @@Merino2022a:

$$ 
\chi^2_{2k} = -2 \sum \log(p_i)
$$

where \( p_i \) is the p-value for Length \( i \) and \( k \) are the degrees of freedom of the four p-values from the joint Length indices. Likelihood profiling was also carried out to quantify parameter uncertainty and identify the influence of priors. Finally, prediction skill was assessed using hindcasting techniques to evaluate the model’s ability to reproduce historical stock dynamics. Retrospective analysis and hindcast cross-validation were performed by sequentially removing five years of data. regarding @HurtadoF2015, Mohn parametrer was calculated as the mean relative error, defined as:

$$ 
\rho_M = \frac{1}{h} \sum_{y=1}^{h} \left( \frac{X_{T - y} - \hat{X}_{T - y}}{\hat{X}_{T - y}} \right)
$$

where \( X \) represents the quantities (such as spawning stock biomass (SSB) or fishing mortality (F)) for which ρM was calculated, and \( \hat{X} \) is the corresponding estimate from the reference model fitted to the full dataset. Year \( y \) was nominally considered as season one, \( T \) refers to the terminal assessment data year, and \( h \) denotes the number of retrospective peels, removing recent years of data ("peeling") and re-estimating the model, allowing for the calculation of retrospective bias (*Rho*) for key metrics such as Spawning Stock Biomass (SSB) and Fishing Mortality (F). To evaluate statistical differences in model performance, we analyzed Root Mean Squared Error (RMSE) values across four scenario configurations (`s1.1`, `s1.2`, `s1.3`, and `s1.4`). The RMSE values were extracted from the variance tuning diagnostics of each scenario and compiled into a data frame for statistical analysis. To test for overall differences among scenarios, a one-way ANOVA [@REF] was conducted, treating RMSE values as the dependent variable and scenario configurations as the categorical factor. AIC


Table \@ref(tab:metrics) summarizes the diagnostic metrics used to evaluate model performance, including goodness-of-fit, prediction accuracy, information criteria, retrospective bias, and estimation stability. 

```{r metrics, eval=TRUE}
df_model_metrics <- data.frame(
  Metric = c(
    "Pearson Residuals",
    "Root Mean Square Error (RMSE)",
    "Mean Absolute Scaled Error (MASE)",
    "Akaike Information Criterion (AIC)",
    "Rho Parameter (B and SSB)",
    "R0 Deviation"
  ),
  Description = c(
    "Standardized residuals calculated as the difference between observed and expected values, divided by the standard deviation of the expected values. Useful for assessing model fit across data points.",
    "Measures the average magnitude of the residuals (prediction errors), giving higher weight to large errors. Lower values indicate better predictive accuracy.",
    "A scale-independent measure of prediction accuracy. It compares forecast errors to the errors from a naive baseline model. Values <1 indicate better-than-baseline performance.",
    "A relative measure of model quality that balances model fit and complexity. Lower AIC values indicate better models, penalizing overfitting.",
    "The autoregressive correlation coefficient from retrospective analysis, used to assess systematic bias in biomass (B) and spawning stock biomass (SSB) estimates across years.",
    "Measures the variability or uncertainty in the estimated unfished recruitment (R₀). High deviations may indicate poor estimation stability or model overparameterization."
  ),
  Reference = c(
    NA,
    "@Carvalho2021b",
    "@Hyndman2006",
    "@Akaike1974",
    "@Mohn1999",
    "@Methot2013"
  ),
  stringsAsFactors = FALSE
)

ft_stat <- flextable(df_model_metrics) |> 
  set_header_labels(
    Metric = "Metric",
    Description = "Description",
    Reference = "Reference"
  ) |> 
  set_caption("Summary of model diagnostic metrics used for krill stock assessment") |> 
  autofit() |> 
  fontsize(size = 10) |> 
  theme_booktabs() |> 
  color(part = "header", color = "black")|>
  set_table_properties(layout = "autofit", width = .85)
ft_stat
```


# Results

### Environmental data 

Based on linear models performances and ecological relevance, Chla emerged as the most influential predictor, therefore, this variable was selected for incorporation into the stock assessment model as an environmental covariate (Table 2, S2). This is consistent with previous studies that have identified this variable as an important driver of variability in different biological components of the krill population and shaping krill habitat suitability and productivity [REF REF REF]. Figure \@ref(fig:mapachl) presents a time series of chlorophyll-a (Chl-a) concentration (mg/m-3) in the waters around the Antarctic Peninsula from 2000 to 2020. Each panel represents a different year, showing spatial variations in Chl-a levels, which indicate phytoplankton biomass. The highest concentrations are observed along the coastal regions, while offshore areas exhibit lower Chl-a levels. This visualization helps assess interannual variability in primary productivity, which is a key driver of the Antarctic krill population dynamics.

```{r mapachl, eval=TRUE, fig.cap="Time series (2000-2020) to Chlorophyll in 48.1 area"}
knitr::include_graphics('Figs/chla_grilled.png')
```

In another hand, Figure \@ref(fig:chlindex) illustrates the interannual variability of a Chlorophyll Variability Index from the year 2000 to 2020. The figure shows notable fluctuations across years, highlighting periods of higher-than-average chlorophyll variability (e.g., 2003, 2016) as well as years with significantly lower values (e.g., 2011, 2020). These patterns suggest substantial year-to-year environmental changes, which may have implications for marine ecosystem productivity and associated trophic dynamics and krill population impacts [REF]. 

```{r chlindex, eval=TRUE, fig.height=2, fig.width=9, fig.cap="Interannual variability of the Chlorophyll Variability Index from 2000 to 2020. Positive anomalies (in red) and negative anomalies (in black) indicate below-average conditions"}
datos <- data.frame(
  anio = 2001:2020,
  variable = c(
    0.684, 0.693, 0.737, 0.683, 0.716, 0.693, 0.670,
    0.708, 0.653, 0.699, 0.642, 0.647, 0.672, 0.658, 0.694,
    0.764, 0.675, 0.724, 0.662, 0.622
  )
)

min_val <- min(datos$variable)
max_val <- max(datos$variable)
datos$indice_ambiental <- 2 * (datos$variable - min_val) / (max_val - min_val) - 1

ggplot(datos, aes(x = anio, y = indice_ambiental)) +
  geom_col(aes(fill = indice_ambiental > 0), width = 0.5) +
  scale_fill_manual(values = c("black", "red")) +
  #geom_line(color = "grey20", size = 1) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(title = "",
       x = "", y = "Env Index") +
  theme_bw() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 90, hjust = 2))+
  scale_x_continuous(breaks = seq(from = 2000, to = 2020, by = 1))
```

### Predator comoponent as driver of krill dynamics

The three main penguin colonies Adélie, Chinstrap, and Gentoo are central place foragers with diet compositions that are strongly linked to krill abundance and demographic structure, particularly during the breeding season when foraging is spatially and temporally constrained [REF Lukcas!, REF Vicky]. Figure \@ref(fig:mapapre) presents a temporal and spatial overview of penguin variables from 2001 to 2020. The top panel in Figure \@ref(fig:mapapre) shows annual boxplots of krill length distributions derived from penguin diet samples, stratified by predator species. Although median krill lengths remain relatively consistent over time, there is notable interannual variability in the spread and distribution of sizes, which may reflect fluctuations in recruitment strength and availability of krill age classes. Foraging activity is concentrated in the Bransfield Strait and surrounding areas, aligning with regions of persistent krill aggregation. This spatial overlap reinforces the ecological relevance of penguin-based indicators in reflecting krill dynamics (middle panel in Figure \@ref(fig:mapapre)). For stock assessment purposes, we integrated all penguin colony abundances into a synoptic index of relative predator biomass, which represents a comprehensive measure of population trends over time (bottom panel in Figure \@ref(fig:mapapre). This index accounts for variations in colonies abundance providing a robust metric that reflects the overall status of the penguin population. The index appears to exhibit fluctuations over time, with a general decline from the early 1990s to the mid-2000s, followed by a period of relative stabilization and another decline toward the end of the time series. This index captures broad decadal declines in predator presence, particularly after 2015, potentially reflecting changes in prey availability, environmental conditions, or predator demography.

```{r mapapre, eval=TRUE, fig.cap= "Ecosystem indicators derived from penguin predator data in the Western Antarctic Peninsula. Top panel: Annual krill length distributions from penguin diet samples by species: Adélie (red), chinstrap (orange), and gentoo (black). A red horizontal line marks the 3.6 cm as recruit size for reference purposes. Middle panel: Spatial foraging locations and relative intensity by species across years. Colored circles indicate locations and intensity of sampling by species, with circle size suggesting sampling effort or frequency. Bottom panel: Synoptic index of relative predator biomass, used as an ecosystem input in the stock assessment model."}
knitr::include_graphics('Figs/Predator_fleet2.png')
```

## Assessment of model perfomance and complexity across ecological scenarios

The krill population dynamics model was evaluated under four increasingly complex scenarios. Scenario s1.1 represented the baseline spatial implicit model, incorporating only survey and fishery data, and resulted in the estimation of 71 parameters. In scenario s1.2, predator-related components were added, including biomass and size-selective predation patterns from key penguin colonies, increasing the parameter count to 107. Scenario s1.3 introduced an environmental covariate as a recruitment driver into the baseline model, leading to the estimation of 96 parameters. Finally, scenario s1.4 integrated both predator and environmental components, culminating in the highest model complexity with 128 estimated parameters.  All model scenarios successfully converged within acceptable tolerance thresholds, with final gradients below 1.00e-04, and positive-definite Hessian matrices confirming robust parameter estimation and local identifiability. 

Regarding model fit, Pearson residuals of predicted length distributions for krill were evaluated across four modeling scenarios, each incorporating different levels of ecosystem complexity. Pearson residuals are used to assess the goodness-of-fit by standardizing the differences between observed and predicted values, allowing for the detection of systematic patterns or biases in model predictions across size classes and sampling sources.


The residuals are visualized by year and length bin, allowing an assessment of model fit over time and across the size structure of the population (Figure \@ref(fig:pearson)). In scenario s1.1 (Without Ecosystem Variables), substantial lack of fit is evident across multiple years and length classes, particularly in the late 1990s and early 2000s. Positive Pearson residuals indicate that the model tends to underestimate frequencies of certain length bins, especially among smaller and mid-sized individuals, suggesting poor representation of recruitment and growth dynamics in the absence of environmental and predator effects. s1.2 (With Predator) shows some improvement in model fit, with slightly more balanced residuals. However, there are still consistent deviations in the mid-size ranges across multiple years, indicating that predation alone does not fully explain observed variability in length composition. In s1.3 (With Environment), there is a noticeable reduction in residual magnitude across several years and size classes, implying that incorporating environmental covariates helps align the model more closely with observed size distributions. This is particularly apparent in the early 2000s, where the residuals are closer to zero across most bins. Finally, s1.4 (With Predator and Ecosystem) shows the most consistent reduction in Pearson residuals across time and size structure. The residual patterns also indicate potentially concerning model misfits, particularly among adult individuals in several survey fleets operating in the Bransfield Strait, as well as among the largest size classes in the predator fleet, which likely represents penguin consumption data. The residuals exhibit consistent over- or under-estimation in specific length bins over multiple years, suggesting that the current model structure may not fully capture key processes affecting the abundance or selectivity of adult individuals. In the case of surveys in Bransfield, this could reflect spatial mismatches between predicted and observed size distributions or biases in survey selectivity for larger size classes. This spatial heterogeneity aligns with previous findings identifying this area as a core juvenile krill habitat [@Mardones2025; @Veytia2021, Vetia et al., 2019, REF, REF]. Similarly, the residuals associated with the predator fleet suggest that the model may inadequately represent size-selective predation or the temporal dynamics of predator consumption. These patterns warrant further investigation into the assumptions underlying length selectivity and mortality, particularly for the adult component of the population, as well as potential ecosystem-driven variability not currently integrated in the model.


Overall, the distribution of residuals is more homogeneous and centered around zero, indicating that the combined inclusion of predator and environmental drivers leads to the best model fit among the four scenarios.


```{r pearson, eval=TRUE, fig.cap= "Pearson residuals of predicted versus observed length-frequency distributions of Antarctic krill across four modeling scenarios (s1.1 to s1.4), each incorporating increasing levels of ecosystem complexity. Residuals are shown by fleet, survey, and predator source, allowing visual assessment of model fit across time and sampling components (Red = positive, Black = negative"}
knitr::include_graphics('Figs/Pearson.png')
```

### Retrospective analysis

Retrospective analyses were conducted to evaluate model performance across four scenarios incorporating different levels of ecosystem complexity (Figure \@ref(fig:rhoplot)). The retrospective pattern for fishing mortality (F) showed a marked increase in bias in scenario s1.4, which included both predator and environmental components, particularly in the terminal year. In this scenario, the combined rho value exceeded 3.5, indicating a strong retrospective pattern. Scenarios s1.2 (predator only) and s1.3 (environment only) also showed elevated rho values relative to s1.1 (baseline model without ecosystem variables), although the magnitude was lower than in s1.4. In contrast, the retrospective pattern for spawning stock biomass (SSB) was consistently negative across all scenarios and years. However, models that included environmental components—s1.3 and s1.4—tended to show larger negative biases in SSB, with scenario s1.4 again exhibiting the most pronounced pattern. The combined rho values for SSB in s1.3 and s1.4 were close to –0.5 and –0.6, respectively, whereas s1.1 showed a comparatively milder retrospective trend. 

```{r rhoplot, eval=TRUE, out.width="75%", fig.cap="Retrospective patterns for fishing mortality (F, left) and spawning stock biomass (SSB, right) across four modeling scenarios differing in ecosystem complexity. Each point represents the rho value for a given terminal year (2016–2019), with Combined indicating the average retrospective bias across years in different scenarios"}
knitr::include_graphics('Figs/unnamed-chunk-46-1.jpeg')
```

### Likelihood components

Log-likelihood profiles were examined for each model scenario (s1.1 to s1.4) to assess how different components contributed to the overall model fit. Across all scenarios, the TOTAL log-likelihood is primarily influenced by the Survey, Length composition, and Recruitment components, with minor contributions from parameter priors. The reference model (s1.1) displays the highest overall likelihood value, particularly due to a stronger fit to the Length composition and Survey data. However, this comes with an elevated penalty in the parm priors categories, suggesting potential overfitting or parameter instability. In contrast, the ecosystem-informed scenarios—s1.2 (with predator data), s1.3 (with environmental data), and s1.4 (with both)—show slightly lower total likelihoods. These models present more balanced likelihood contributions across data components and generally lower penalties for parameter priors and deviations, indicating a more stable parameterization despite reduced absolute fit. Notably, the Recruitment likelihood contribution decreases in the ecosystem scenarios compared to the reference, which aligns with previous results showing constrained recruitment variability when ecological drivers are included. These variations may reflect differences in model assumptions or input data between scenarios, which could affect how well each model fits particular data sources. Table \@ref(tab:tablike) shows the log-likelihood component values for each scenario. 




```{r tablike, eval=TRUE}
parameter_comparison_table <- read_csv("parameter_comparison_table.csv") %>% 
  dplyr::slice(1:6)  
  
parameter_comparison_table %>%
  mutate(across(
    where(is.numeric),
    ~ formatC(., format = "f", digits = 3, decimal.mark = ".")
  )) %>%
  flextable() %>%
  set_caption("Log-likelihood contributions of different components across model scenarios, including the total likelihood and individual contributions from survey indices, length composition data, recruitment, and parameter priors.") %>% 
  autofit() %>%
  theme_vanilla() %>%
  fontsize(size = 10, part = "all") %>%
  #font(fontname = "Arial", part = "all") %>%
  set_table_properties(layout = "autofit", width = .85)

```

### Root Mean Square Error (RMSE)

Another step to measure the model performance in krill stock assessment was evaluated using the Root Mean Square Error (RMSE) across four scenarios of increasing ecological complexity (Figure \@ref(fig:rmseplot)). Scenario Model1.1, which excludes both environmental and predator variables, showed the lowest median RMSE and the narrowest interquartile range, suggesting higher consistency in model fits to observed data. The inclusion of ecosystem variables in Model1.2 (predator only), Model1.3 (environment only), and Model1.4 (both) resulted in increases in RMSE dispersion and median values, although the differences were relatively moderate. Among the ecosystem-informed scenarios, Model1.3 and Model1.4 had comparable RMSE distributions, slightly exceeding those of the predator-only model (Model1.2). The increased variability in RMSE under these scenarios suggests a reduction in overall fit quality when ecological complexity is introduced, likely reflecting increased model structural uncertainty or misalignment between ecological covariates and population dynamics.


```{r rmseplot, eval=TRUE, fig.cap="Root Mean Square Error (RMSE) distributions for four krill population model scenarios"}
knitr::include_graphics('Figs/diags2.png')
```

(FINAL TABLE Suggested by MJ)



## Comparision outputs between scenarios

Model outputs under different ecosystem scenarios revealed substantial variation in krill population indicators, including total biomass (Bio_all), summary biomass (Bio_smry), recruitment (Recruit_0), and spawning biomass (SpawnBio) (Figure \@ref(fig:popvar)). The reference model (s1.1), which excluded environmental and predator components, consistently produced higher median estimates and wider uncertainty intervals across all population indicators. Inclusion of predator components (s1.2) or environmental variables (s1.3) led to reductions in central tendency and variability for all metrics, with s1.3 (environment-only) showing the most constrained estimates, particularly for recruitment and spawning biomass. Scenario s1.4, which incorporated both environmental and predator components, resulted in intermediate biomass and recruitment estimates, with moderate variance compared to the other scenarios. Recruitment (Recruit_0) was especially sensitive to the inclusion of ecosystem components. The highest median recruitment was observed under s1.2 (predator-only), while the lowest was seen in s1.3 (environment-only), highlighting the contrasting influences of these ecological factors.

We compare the time series of different population variables for Antarctic krill under most significant models in this analysis; a reference model without environmental or predator data and an alternative model that incorporates both environmental and predator information. Total biomass estimates remain relatively stable across both scenarios until around 2010. From that point onward, both models show a marked increase in biomass, although the reference model predicts higher values than the ecosystem-informed model, particularly during the final assessment years (2018–2020). Recruitment at age 0 exhibits strong variability over time. This is coincidence with [REF]. While both models show similar patterns, the reference model tends to estimate higher recruitment peaks, especially in recent years. Finally, spawning biomass (SpawnBio) follows trends similar to total biomass. Both models show a gradual increase after 2010, but the reference model again yields higher values in recent years. 

```{r compara,eval=TRUE, out.width="60%", fig.cap="Comparisons of krill population variables under scenarios of increasing ecosystem complexity. Metrics include total biomass (Bio_all), summary biomass (Bio_smry), recruitment (Recruit_0), and spawning biomass (SpawnBio)"}
knitr::include_graphics('Figs/alloutput_s1_4.png')
```

Biologically, ln(R0) represents the expected log-scale recruitment in the absence of fishing, providing a proxy for the reproductive potential or productivity of the population under pristine conditions. Figure \@ref(fig:compara2) displays posterior density distributions for the natural logarithm of virgin recruitment level (ln(R0)) across four model configurations. The narrow and well-separated peaks across models suggest that each model configuration yields distinctly different estimates of recruitment potential, likely reflecting differences in underlying assumptions such as natural mortality, selectivity, or the inclusion of predation effects. From a biological perspective, the higher ln(R0) values in `s1.3` and `s1.4` suggest that, under those model assumptions, the krill population could sustain higher levels of recruitment in unfished conditions, potentially reflecting stronger compensatory dynamics or reduced natural mortality (e.g., lower predation pressure). Conversely, the lower ln(R0) values in `s1.1` and `s1.2` imply a population with lower reproductive output, which might make it more vulnerable to overfishing or environmental variability. This highlights the sensitivity of the recruitment parameter to assumptions about ecological drivers in the stock-recruitment relationship.

```{r compara2, eval=TRUE, out.width="60%", fig.cap="Estimated R0 parameter for Antarctic krill under four assessment scenarios. Models including predator and environmental data"}
knitr::include_graphics('Figs/R0plot.png')

```

The stock–recruitment relationship was examined under two model scenarios: s1.1, a reference model excluding ecosystem components, and s1.4, which incorporates both environmental and predator data  (Figure \@ref(fig:proplot)). The plot illustrates the relationship between spawning stock biomass (SSB) and recruitment across years, overlaid with a fitted Beverton-Holt function derived from the model with ecosystem covariates. Scenario s1.1 (diamonds) displays a wider spread in recruitment estimates across the full range of SSB values, with several years (e.g., 2017, 2014) producing exceptionally high recruitment despite moderate to low SSB. In contrast, scenario s1.4 (crosses), which integrates ecosystem variables, generally shows lower recruitment estimates, with reduced variance and more clustered residuals at low SSB values. The fitted Beverton-Holt curve (in blue) from s1.4 captures the expected saturating recruitment response to increasing SSB. Notably, the inclusion of ecosystem variables appears to reduce extreme recruitment events and leads to a more stable, density-dependent recruitment pattern aligned with theoretical expectations. 
Estimating the productivity of Antarctic krill is critical for understanding the species capacity to replenish its population in response to varying levels of spawning biomass. Here, we defined the Productivity as the ratio of recruitment to spawning stock biomass, provides a standardized measure of reproductive success and population resilience under different ecological and fishing pressures. For each scenario \( i \) and year \( t \), we computed the productivity as the ratio between recruitment and spawning stock biomass (SSB):

$$
\text{Productivity}_{i,t} = \frac{\text{Recruitment}_{i,t}}{\text{SSB}_{i,t}}
$$
This plot illustrates the relationship between recruitment per unit of spawning stock biomass (Recruitment/SSB) and relative spawning stock biomass (SSB/SSBo) for four scenarios (s1.1 to s1.4)  (Figure \@ref(fig:proplot)). As expected under compensatory recruitment dynamics, all scenarios show a declining trend in productivity as SSB increases, indicating higher per-capita recruitment at low stock levels and reduced productivity as the population approaches its unfished biomass. The scenarios differ markedly in the magnitude of predicted productivity. Scenario s1.1 and s1.3 show higher productivity levels throughout the SSB range when compared to s1.2 and, most notably, s1.4. The latter scenario presents the lowest productivity values, indicating either reduced recruitment compensation or differences in the stock-recruitment parameters. These contrasting trends highlight how scenario-specific assumptions or structural choices influence estimates of productivity. These patterns reflect a more precautionary and ecologically realistic recruitment dynamic, where environmental variability limits the ability of the stock to maintain high productivity under depleted conditions. Overall, the results emphasize the influence of ecosystem variables on shaping recruitment dynamics and demonstrate that incorporating environmental drivers into the assessment model leads to more conservative productivity estimates, particularly at low spawning biomass levels.


```{r proplot, eval=TRUE, fig.cap="Left panel: Stock–recruitment relationships for Antarctic krill under four assessment scenarios. Predicted recruitment as a function of spawning stock biomass (SSB), with fitted Beverton-Holt curves and annual labels for selected years. Right panel: Recruitment per unit of SSB plotted against relative SSB (SSB/SSBo), illustrating differences in per-capita productivity across models ( s1.1 (no ecosystem variables), s1.2 (with predator effects), s1.3 (with environmental variables), and s1.4 (with both predator and environmental effects))"}
knitr::include_graphics('Figs/produc_com.png')
```


Autocorrelation functions (ACF) of model residuals were used to assess the temporal structure and potential misspecification across the four configurations (`s1.1` to `s1.4`) (Figure \@ref(fig:acfplot)). The reference model (`s1.1`) displays significant autocorrelation at the first three lags, indicating serial correlation and potential misspecification. In `s1.2`, which includes predator dynamics, the autocorrelation is more dispersed, with significant values at early lags and at lag 13, suggesting the introduction of temporal structure not fully accounted for. In contrast, `s1.3`, which incorporates environmental variability, shows a marked reduction in autocorrelation beyond the first lag, with most values within confidence bounds—indicating improved model independence. The fully integrated model (`s1.4`), combining predator and environmental effects, exhibits an autocorrelation pattern comparable to `s1.3`, with low residual autocorrelation overall, though slight structure persists at early lags.


```{r acfplot, eval=TRUE, fig.cap="Autocorrelation function (ACF) plots of model residuals for four krill assessment scenarios Blue dashed lines indicate 95% confidence intervals"}
knitr::include_graphics('Figs/ACF2.png')
```


A *t-test*, assuming normality and homoscedasticity, revealed a statistically significant difference in spawning biomass estimates between models `s1.1` and `s1.4` (*t = 4.2682, df = 72, p < 0.001*), with a 95% confidence interval for the mean difference ranging from *1,387,011 to 3,818,074*. Mean spawning biomass estimates were *4,600,304 t* for `s1.1` and *1,997,762 t* for `s1.4`. A non-parametric *Wilcoxon rank sum test* further confirmed this difference (*W = 1256, p < 0.001*), reinforcing the robustness of the result despite minor warnings due to ties in the dataset. These findings demonstrate that incorporating predator and environmental covariates into the population model (scenario `s1.4`) leads to significantly lower estimates of spawning biomass. This highlights the critical role of ecosystem components in influencing recruitment and population structure, and their importance in comprehensive stock assessment frameworks for krill.

### Model scenarios diagnostics summary

The comparative evaluation of the four model scenarios (s1.1–s1.4) revealed key differences in model performance and complexity (Table \@ref(tab:diagnostics)).  All four scenarios achieved convergence, as indicated by a maximum gradient component of zero, ensuring that optimization reached a stable solution. Notably, the number of estimated parameters varied across models, with the full ecosystem model (s1.4) estimating the same number of parameters as the predator-only model (s1.2), while the environment-only model (s1.3) and the base model (s1.1) used fewer parameters. The Akaike Information Criterion (AIC) reveals stark contrasts in model performance. The environment-inclusive models (s1.3 and s1.1) have substantially lower AIC values (3,234.9 and 2,668.1, respectively) compared to the predator-inclusive models (s1.2 and s1.4), which exceed 50,000. These results suggest that environmental covariates contribute more effectively to explaining krill population dynamics than predator effects alone. The total likelihood (−logL) further supports this, showing much better fit in models s1.1 and s1.3, while predator-inclusive models (s1.2 and s1.4) show considerably poorer likelihood values. This pattern is reflected in the survey and length composition likelihood components, where again the environment-only model (s1.3) shows superior performance compared to predator scenarios. Root Mean Square Error (RMSE) for both index and length composition highlights better predictive accuracy in models without predators. Model s1.1 and s1.3 achieve lower RMSE values for both indices and length composition, indicating better alignment with observed data. In contrast, RMSE values are higher in predator-inclusive models (s1.2 and s1.4), suggesting poorer fit. Similarly, the Mean Absolute Scaled Error (MASE) remains lower in s1.1 and s1.3 (0.427), compared to s1.2 and s1.4 (0.517), again highlighting improved predictive performance in models that exclude predator effects. Retrospective biases (rho values) provide insight into model consistency over time. Retrospective bias in spawning stock biomass (Retro_Rho_ssb) and forecast biomass (Forecast_Rho_ssb) is substantially reduced in models without predators, particularly s1.1 (−0.233 and −0.333). Models including predators (s1.2 and s1.4) show larger negative rho values, indicating stronger retrospective bias and less stability in biomass estimation. Fishing mortality bias (Rho_f) and its forecast also present serious concerns in predator-inclusive scenarios. Model s1.4, for instance, shows a high retrospective bias in fishing mortality (Rho_f = 6.912), compared to 1.585 in the base model (s1.1). This indicates over-sensitivity in mortality estimates when predator effects are included without sufficient constraint or supporting data.


```{r diagnostics, eval=TRUE, warning=FALSE, message=FALSE}
diagnostics <- read_csv("model_diagnosis.csv")
#write_csv(diagnostics, "model_diagnosis.csv")
flextable(diagnostics) %>%
  colformat_num(digits = 3) |>  
  set_caption("Statistical componentes to evaluate perfomances and diagnostic of model scenarios") %>%
  autofit() %>%
  theme_booktabs() %>%
  fontsize(size = 10, part = "all") %>%
  set_table_properties(width = .85, layout = "autofit")
```

# Discusion

The use of integrated models for assessing krill populations in the Southern Ocean has posed significant challenges for CCAMLR, particularly in light of the inherent uncertainties and limitations associated with data-poor regions. One of the key challenges is the reliance on models like the General Yield Model (GRYM) [REF], which assumes stable environmental conditions—a premise that increasingly fails to hold true in the context of ongoing climate change [REF]. GRYM, while useful for certain data-poor applications, faces difficulties due to its heavy dependence on life history parameters, such as growth rates, harvest strategies, and natural mortality. Moreover, the assumption of stable environmental conditions in such models is problematic [REF], as climate variability significantly influences krill productivity and survival. As a result, predictions based on GRYM and similar models become less reliable, particularly in the face of changing environmental conditions or ecological considerations. This highlights the need for more dynamic, ecosystem-informed approaches to stock assessment that consider the evolving nature of environmental and ecological drivers, such as changes in sea ice extent, primary productivity, and predator-prey interactions.

The transition from traditional, model-based approaches like GRYM to more integrated, ecosystem-based models presents a significant opportunity to improve the scientific basis of krill stock assessments. However, this shift also requires addressing the trade-offs between model complexity and data availability [REF]. While integrated models offer a more holistic view of krill population dynamics by incorporating ecosystem variables, they also introduce new challenges related to the accuracy and reliability of model inputs. Thus, the development of integrated models requires continuous refinement to ensure that they remain relevant and robust in the face of environmental change. [REF]

Management strategies should incorporate ecosystem-based thresholds informed by environmental and predation dynamics, as these factors are critical in maintaining krill availability for predators, which is essential for overall ecosystem balance. Additionally, the ongoing warming in the Antarctic Peninsula highlights the urgent need to integrate climate-driven changes into habitat suitability models, ensuring that management approaches remain adaptive to shifting environmental conditions.

Although integrated models are not new to krill in the Southern Ocean, CCAMLR has for years applied methodologies that incorporate diverse data sources. External reviews, such as @Thomson2016, have endorsed these approaches as improvements over traditional models. Previous studies like @Kinzey2011, @Kinzey2015a, @Kinzey2019a, and @Wang2021 have advanced integrated frameworks, though challenges like model convergence remain.

This analysis represents a modern approach to stock assessment of complex dynamics such as krill, integrating ecosystem components like environmental variables and ecological aspects such as predators. Integrated stock assessment models can support adaptive management, wherein outputs like status or quotas are adjusted based on ecosystem monitoring indices [REF]


Spatial heterogeneity is a fundamental aspect of krill ecology, driven by factors including oceanographic conditions and predator foraging behavior. Incorporating strata into our model captures complex spatial patterns of krill distribution, enabling identification of hotspots, productivity zones, and ecological corridors. [REF]

These progressive increments in parameter numbers reflect the added ecological realism and mechanistic detail captured in each scenario, emphasizing the role of top-down and bottom-up processes in krill dynamics.

### Predation and Natural Mortality

The study area encompasses the primary spawning, breeding, and wintering regions of Antarctic krill in the southwest Atlantic Ocean. Evidence indicates that penguin predation exerts strong top-down control on krill populations. Penguins, as krill specialists, have reproductive success tied closely to krill availability. [REF]

Incorporating predation into stock models addresses the underestimation of uncertainty in natural mortality, which can otherwise skew biomass and productivity estimates by as much as 20% [@Hollowed2000].

Overall, the results support the conclusion that ecosystem-informed models better capture the temporal and size-structured dynamics of krill, with the joint inclusion of predator and environmental variables yielding the most robust representation of observed length compositions. The inclusion of environmental covariates (s1.3 and s1.4) markedly improves the temporal independence of model residuals, as indicated by lower autocorrelation beyond lag 1. This implies that environmental variability contributes significantly to explaining observed trends in krill population dynamics. Conversely, the predator-only model (s1.2) introduces more persistent autocorrelation, indicating that its effects may require more nuanced representation or additional process structuring. Overall, these results highlight the benefit of including environmental signals to reduce residual autocorrelation and enhance model fit. This analysis coincides with... [REF]

The analysis indicates that incorporating environmental and predator data into the stock assessment framework introduces greater variability in model fit, as measured by RMSE. While the baseline model (Model 1.1) demonstrates more stable performance, it potentially achieves this at the cost of biological realism. The modest trade-off in predictive accuracy associated with ecosystem-informed models is expected and highlights the need to balance goodness-of-fit with ecological plausibility when developing integrated assessment models.

The inclusion of predator and environmental variables significantly alters model behavior in retrospective diagnostics, particularly increasing bias in terminal-year estimates of fishing mortality and deepening the underestimation of spawning stock biomass (SSB). These patterns suggest that while ecosystem-informed models improve the biological realism of the stock assessment, they also pose challenges in terms of stability and predictive consistency. Such outcomes underline the importance of further refining the structure and parameterization of ecosystem components when integrating them into assessment frameworks, to balance realism with diagnostic robustness.

Likelihood decomposition reveals that models incorporating ecological data (s1.2–s1.4) yield slightly lower total likelihoods than the reference model (s1.1), reflecting trade-offs between model fit and biological realism. The reduced penalty terms and more evenly distributed likelihood contributions in the ecosystem scenarios suggest improved model stability and reduced overparameterization. These results reinforce the value of integrating ecosystem variables not only for enhancing ecological interpretation but also for promoting robust model structure and parameter behavior.

### Stock-Recruitment and Biomass Estimates

Integrating environmental and predator components into the population model (s1.4) substantially affects the shape and variability of the stock–recruitment relationship. The ecosystem-informed model reduces the occurrence of extreme recruitment outliers and yields a more consistent relationship between SSB and recruitment. [REF]

Models that omit ecosystem components tend to produce higher and more uncertain projections, potentially overestimating stock productivity. The inclusion of these variables leads to more conservative and constrained outputs, which may better reflect the ecological dynamics governing krill populations.

### Productivity

The inclusion of environmental variables (s1.3 and s1.4) substantially lowers estimates of per-capita productivity, especially at low stock levels. These ecosystem-informed scenarios reflect more realistic ecological constraints and reduce the risk of overestimating krill productivity under unfavorable conditions. This highlights the importance of accounting for environmental drivers in stock assessment models to avoid overly optimistic projections of stock resilience. [REF]

Population variables: Overall, the inclusion of ecosystem and predator data (s1.4) results in more conservative estimates of biomass, recruitment, and spawning stock, suggesting that ecosystem-informed models may provide a more precautionary and ecologically realistic basis for krill stock assessment and management.

### Ecosystem Variables: Ecological Relevance

Variations in krill size composition in penguin diets have been shown to reflect underlying changes in krill population dynamics, including recruitment pulses and cohort strength [Jeff REFs]. Thus, penguin diet data serve as a proxy for detecting cyclical patterns in krill recruitment that may not be evident through direct surveys alone. [REF]

The ecosystem variables used in assessment processes vary from their definition to how they are applied. Environmental variables influencing krill recruitment, as well as predators that introduce an additional component of natural mortality into the model, are among those considered in this study. [REF] 

Marshall et al. (2019) [REF] classify ecosystem variables based on their impact on population dynamics and how they are incorporated into stock assessment models. They suggest that integrating variables, especially recruitment, directly within the model results in a more dynamic and accurate representation of population dynamics, as it captures real-time interactions between ecological factors. In contrast, external incorporation may not fully capture ecosystem feedback loops, potentially leading to less reliable assessments.

Our analysis, which integrates ecosystem variables directly within the model, aligns with the conclusions of Marshall et al. (2019) and provides further evidence that this approach offers superior accuracy in modeling krill population dynamics. By including both environmental drivers and predation pressures within the model, our study captures the complexity of krill dynamics more effectively, offering a more realistic representation of krill biomass, recruitment, and mortality processes. This integrated approach not only improves model precision but also enhances its predictive power, addressing key ecological factors that influence krill populations.

This analysis represents a significant step forward in the incorporation of ecosystem-based considerations into krill stock assessments in the Southern Ocean. By adopting a more comprehensive, ecosystem-informed model, we contribute to the growing body of research supporting the integration of ecosystem variables in stock assessment frameworks [REF]. This approach is consistent with the new and evolving management strategies of the Commission for the Conservation of Antarctic Marine Living Resources (CCAMLR), which increasingly emphasizes ecosystem-based management practices. As climate change and ecosystem variability continue to impact krill populations, this analysis provides a foundation for precautionary management strategies that are better aligned with the dynamic nature of marine ecosystems.


Tabla summary

The analysis suggests that incorporating environmental variables (s1.3 and s1.4) improves model fit and predictive accuracy, particularly when compared to predator-only models. The model that includes only environmental covariates (s1.3) strikes the best balance between fit quality, complexity, and retrospective performance, suggesting that environmental variability is a key driver of krill population dynamics in the Western Antarctic Peninsula.

In contrast, the inclusion of predators alone (s1.2) leads to poorer model fit and higher retrospective bias, possibly due to data limitations or unaccounted complexity in predator-prey dynamics. While the full ecosystem model (s1.4) shows some improvements over the predator-only model, it still exhibits significant retrospective biases, highlighting the need for refined integration of ecosystem components and further data support, particularly regarding predator consumption rates and spatial foraging behavior.

These findings support growing consensus that ecosystem-informed stock assessments, particularly those that integrate environmental covariates, provide more robust and ecologically realistic estimates for Antarctic krill and should inform precautionary management frameworks under CCAMLR.



\newpage

# Conclusion

The integration of ecosystem variables, such as penguin predation and environmental conditions, significantly enhances the accuracy of krill population dynamics models by capturing complex and time-varying ecological processes. This approach provides a more realistic reflection of fluctuations in krill biomass and recruitment. The results emphasize that environmental conditions, particularly primary productivity, directly affect krill recruitment dynamics, highlighting the importance of considering climate variability in the sustainability of krill fisheries, especially in light of global climate change. Furthermore, predation by species like penguins plays a crucial role in the natural mortality of krill, and including this factor in the models improves estimates of natural mortality, offering a more accurate assessment of krill population health, which is vital for sustainable management. Ecosystem-informed models, while providing more biologically accurate projections, tend to produce more conservative and less optimistic estimates compared to traditional models. This helps mitigate the risk of overestimations that could lead to unsustainable management decisions. However, these models also introduce challenges such as increased sensitivity and retrospective bias, particularly in fishing mortality estimates, underscoring the need for a balance between ecological realism and model stability to ensure reliable management decisions. Overall, these findings reinforce that ecosystem-based approaches provide a stronger scientific foundation for fishery management, but they must be carefully managed to avoid potential instability in model outputs.

\newpage

# Acknowledgments 

This research was supported by the following funding sources: the INACH "Marine Protected Areas" Program (Grant No. 2409052), the ANID/Millennium Science Initiative Program (Grant No. ICN2021_002), the CCAMLR Scholarship Scheme (2023-2024), and the Doctorate Scholarship from CENTRO-IDEAL at the Universidad Austral de Chile. The authors extend their gratitude to the Secretariat of the Commission for the Conservation of Antarctic Marine Living Resources (CCAMLR) for providing access to the krill fishery data, which was instrumental to this study.

# Supplementary Material 

-   Supplementary Material 1: analisis, formulas, and outputs of stock assessment of Antarctic krill in WAP can be found in this [link](https://mauromardones.github.io/SA_Krill/). 

-   Supplementary Material 2: Correlation analysis between krill recruitment and environmental variables can be found in this [link](https://mauromardones.github.io/Krill_recruit_env/) 


# Data Availability

Data will be made available on request.

\newpage

# References
